<%@ page language="java" import="java.util.*,com.amarsoft.awe.dw.ui.validator.ICustomerRule" pageEncoding="GBK"%><%@page import="java.sql.*"%><%@page import="com.amarsoft.are.ARE"%><%
String sClass = request.getParameter("ClassName");
String sValue = java.net.URLDecoder.decode(request.getParameter("Value"),"UTF-8").replaceAll("⊙≌□","&");
if(sValue.equals("")){
	out.print("true");
	return;
}
//拼接参数
Hashtable params = new Hashtable();
for(java.util.Enumeration enum1 = request.getParameterNames(); enum1.hasMoreElements();){
	String sKey = (String)enum1.nextElement();
	if(sKey.equals("ClassName"))continue;
	if(sKey.equals("Value"))continue;
	if(request.getParameter(sKey)!=null){
		String sParamValue = java.net.URLDecoder.decode(request.getParameter(sKey).toString(),"UTF-8");
		params.put(sKey,sParamValue.replaceAll("⊙≌□","&"));
	}
}
ARE.getLog().trace("开始Class验证，接收参数：sClass=" + sClass + "|value=" + sValue);
try{
	if(sClass!=null){
		ICustomerRule rule = (ICustomerRule)Class.forName(sClass).newInstance();
		String sResult = rule.valid(sValue,params);
		if(sResult.equals("")){
			out.print("true");
		}
		else{
			out.print(sResult);
		}
	}
	else{
		out.print("未定义校验类");
	}
}
catch(Exception e){
	e.printStackTrace();
	ARE.getLog().error("class校验【忽略空】出错了："+e.toString());
	out.print("出错了："+e.toString());
}
%>