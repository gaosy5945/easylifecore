<%@ page contentType="text/html; charset=GBK"%><%@ include file="/Frame/resources/include/include_begin.jspf"%><%@ page import="com.amarsoft.are.jbo.BizObject"%><%@ page import="com.amarsoft.dict.als.cache.CodeCache"%><%String PROJECTNO = DataConvert.toString(CurPage.getParameter("SerialNo"));//合作项目流水号if(PROJECTNO == null) PROJECTNO = "";BizObject prjbiz = JBOFactory.getFactory().getManager("jbo.prj.PRJ_BASIC_INFO").createQuery("O.SERIALNO = :PROJECTNO").setParameter("PROJECTNO",PROJECTNO).getSingleResult(true);String PROJECTTYPEID = prjbiz.getAttribute("PROJECTTYPE").toString();if(PROJECTTYPEID == null) PROJECTTYPEID = "";String PROJECTTYPE = CodeCache.getItem("ProjectType", PROJECTTYPEID).getItemName();// 合作项目类型if(PROJECTTYPE == null) PROJECTTYPE = "";String PROJECTNAME = prjbiz.getAttribute("PROJECTNAME").toString();// 合作项目名称if(PROJECTNAME == null) PROJECTNAME = "";String COOPCUSTCD = prjbiz.getAttribute("CUSTOMERID").toString();// 特约商户编码if(COOPCUSTCD == null) COOPCUSTCD = "";String COOPNAME = Sqlca.getString("select customername from customer_list where customerid = '"+COOPCUSTCD+"'");// 特约商户名称if(COOPNAME == null) COOPNAME = "";String NYR = "";// 贷款最长期限String STARTDATE = prjbiz.getAttribute("EFFECTDATE").toString();// 合作项目起日if(STARTDATE == null) STARTDATE = "";String ENDDATE = prjbiz.getAttribute("EXPIRYDATE").toString();// 合作项目止日if(ENDDATE == null) ENDDATE = "";String LIMITFORMNAME = "";// 规模额度控制方式String REVOLVINGFLAG = Sqlca.getString(new SqlObject("select REVOLVINGFLAG from CL_INFO where ObjectType = 'jbo.prj.PRJ_BASIC_INFO' and PARENTSERIALNO is null and ObjectNo = :ObjectNo and CLTYPE = '2001'").setParameter("ObjectNo", PROJECTNO));if(REVOLVINGFLAG == null) REVOLVINGFLAG = "";if("1".equals(REVOLVINGFLAG)){	LIMITFORMNAME = "余额";}else if("2".equals(REVOLVINGFLAG)){	LIMITFORMNAME = "贷款累计发放额";}String LIMITFORMNAME1 = "";// 担保额度控制方式String REVOLVINGFLAG1 = Sqlca.getString(new SqlObject("select REVOLVINGFLAG from CL_INFO CI, GUARANTY_CONTRACT GC, PRJ_RELATIVE PR where PR.ObjectNo=GC.SerialNo and PR.ObjectType='jbo.guaranty.GUARANTY_CONTRACT' and CI.OBJECTNO=gc.SERIALNO and CI.OBJECTTYPE='jbo.guaranty.GUARANTY_CONTRACT' and CI.ParentSerialNo is null and PR.ProjectSerialNo=:ObjectNo").setParameter("ObjectNo", PROJECTNO));if(REVOLVINGFLAG1 == null) REVOLVINGFLAG1 = "";if("1".equals(REVOLVINGFLAG1)){	LIMITFORMNAME1 = "余额";}else if("2".equals(REVOLVINGFLAG1)){	LIMITFORMNAME1 = "贷款累计发放额";}String LOANLIMIT = Sqlca.getString("select nvl(BUSINESSAPPAMT,'0.0') from cl_info where OBJECTTYPE='jbo.prj.PRJ_BASIC_INFO' and PARENTSERIALNO is null and objectno = '"+PROJECTNO+"' and CLTYPE = '2001'");// 项目规模额度LOANLIMIT = DataConvert.toMoney(LOANLIMIT);if(LOANLIMIT == null) LOANLIMIT = "";String GUARANTEELIMIT = Sqlca.getString("select nvl(ci.BUSINESSAPPAMT,'0.0') from cl_info ci ,GUARANTY_CONTRACT gc, PRJ_RELATIVE pr where pr.ObjectNo=gc.SerialNo and "+							"pr.ObjectType='jbo.guaranty.GUARANTY_CONTRACT' and ci.OBJECTNO=gc.SERIALNO and ci.OBJECTTYPE='jbo.guaranty.GUARANTY_CONTRACT'"+							" and ci.ParentSerialNo is null and pr.ProjectSerialNo='"+PROJECTNO+"'");// 项目担保额度GUARANTEELIMIT = DataConvert.toMoney(GUARANTEELIMIT);if(GUARANTEELIMIT == null) GUARANTEELIMIT = "";							//查询审批意见ASResultSet ft = Sqlca.getResultSet(new SqlObject("select FT.* from FLOW_TASK FT,FLOW_MODEL FM,FLOW_OBJECT FO where FO.ObjectType = 'jbo.prj.PRJ_BASIC_INFO' and FO.ObjectNo = :ObjectNo "+"and FO.FlowSerialNo = FT.FlowSerialNo and FO.FlowNo = FM.FlowNo and FO.FlowVersion = FM.FlowVersion and FM.PhaseNo = FT.PhaseNo and FM.PhaseType = '0250' order by FT.TaskSerialNo").setParameter("ObjectNo", PROJECTNO));String PhaseName = "";String PhaseActionType = "";String PhaseOpinion = "";%>

<style>#table td{ border-right:none; border-bottom:none;}#table{ border-left:none; border-top:none;} </style><body><div align="center" ><br><br><table width="598" border="1" cellpadding="3" bordercolor = "black" cellspacing = "0" id="table" style='word-break:break-all;line-height: 150%'>
 <tr >  <td colspan=20 align="center">  <p style='font-size:14.0pt;font-family:楷体_GB2312;mso-hansi-font-family:宋体;  mso-bidi-font-family:宋体;color:black'><b>上海浦东发展银行合作项目审批表</b></p>  </td> </tr> <tr>  <td colspan=4 width="120">&nbsp;合作项目编号</td>  <td colspan=16 >&nbsp;<%=PROJECTNO %></td></tr>  <tr>  <td colspan=4>&nbsp;合作项目类型</td>  <td colspan=6 width="200">&nbsp;<%=PROJECTTYPE%></td>  <td colspan=4>&nbsp;合作项目名称</td>  <td colspan=6>&nbsp;<%=PROJECTNAME%></td></tr>  <tr>  <td colspan=4>&nbsp;特约商户编码</td>  <td colspan=6>&nbsp;<%=COOPCUSTCD%></td>  <td colspan=4>&nbsp;特约商户名称</td>  <td colspan=6>&nbsp;<%=COOPNAME%></td></tr> <%--  <tr >  <td colspan=4>&nbsp;贷款最长期限</td>  <td colspan=6>&nbsp;<%=NYR%></td>  <td colspan=4>&nbsp;额度控制方式</td>  <td colspan=6>&nbsp;<%=LIMITFORMNAME%></td></tr>  --%> <tr>  <td colspan=4>&nbsp;合作项目起日</td>  <td colspan=6>&nbsp;<%=STARTDATE%></td>  <td colspan=4>&nbsp;合作项目止日</td>  <td colspan=6>&nbsp;<%=ENDDATE%></td></tr><tr>  <td colspan=4>&nbsp;项目规模额度</td>  <td colspan=6>&nbsp;<%=LOANLIMIT%></td>  <td colspan=4 width="150">&nbsp;规模额度控制方式</td>  <td colspan=6>&nbsp;<%=LIMITFORMNAME%></td></tr><tr>  <td colspan=4>&nbsp;项目担保额度</td>  <td colspan=6>&nbsp;<%=GUARANTEELIMIT%></td>  <td colspan=4 width="150">&nbsp;担保额度控制方式</td>  <td colspan=6>&nbsp;<%=LIMITFORMNAME1%></td></tr><%while(ft.next()){	PhaseName = ft.getString("PhaseName");	if(PhaseName == null) break;	PhaseActionType = ft.getString("PhaseActionType");	PhaseActionType = CodeCache.getItem("BPMPhaseActionType", PhaseActionType).getItemName();	if(PhaseActionType == null) PhaseActionType = "";	PhaseOpinion = ft.getString("PhaseOpinion");	if(PhaseOpinion == null) PhaseOpinion = "";%><tr>  <td colspan=2 width="2" style="padding-left:22px" valign="top" height="1"><%=PhaseName%></td>  <td colspan=18 valign="top" heigth="auto">	  <table width="100%" heigth="100%">	  	<tr height="1">	  		<td><%=PhaseActionType%></td>	  	</tr>	  	<tr height="<%=17*PhaseName.length()%>" valign="top">	  		<td ><%=PhaseOpinion%></td>	  	</tr>	  	<tr height="1" valign="bottom">	  		<td valign="bottom" align="right">签字&nbsp;<%=ft.getString("UserName")%>&nbsp;&nbsp;&nbsp;日期&nbsp;<%=ft.getString("InputDate")%>&nbsp;&nbsp;&nbsp;机构&nbsp;<%=ft.getString("OrgName")%></td>	  	</tr>	  </table>  </td></tr><% }%> <br> <table align="center">	<tr>			<td id="print"><%=HTMLControls.generateButton("打印", "打印", "printPaper()", "") %></td>	</tr></table></body><script>   function printPaper(){	   var print = document.getElementById("print");	   if(window.confirm("是否确定要打印？")){		   //打印	  		   print.style.display = "none";		   window.print();			   window.close();	   }   }</script><%@ include file="/Frame/resources/include/include_end.jspf"%>
